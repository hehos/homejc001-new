!function(t,i){var a=function(){this.o={cols:4,lazy:i,initNum:15,animation:null,CLASSNAME_ITEM:"media-item",CLASSNAME_GROUP:"items-group",CLASSNAME_COLS_PREFIX:"media-col"}};a.prototype={init:function(i,a){var n=this,o=n.el=i;a&&(a.cols&&(a.cols<2||isNaN(parseInt(a.cols)))&&(a.cols=n.o.cols,alert("cols参数值非法！已设为默认值")),a.initNum&&(a.initNum<n.o.cols||isNaN(parseInt(a.initNum)))&&(a.initNum=n.o.initNum,alert("initNum参数值非法！已设为默认值")));var a=n.o=t.extend(n.o,a),e=n.itemsGroup=[],s=0!=i.find("."+a.CLASSNAME_ITEM).length?i.find("."+a.CLASSNAME_ITEM):i.find("li"),l=t("<div>").addClass(i.attr("class"));i.after(l),n.el=i=l,i.addClass(a.CLASSNAME_COLS_PREFIX+a.cols);for(var r=0;r<a.cols;r++)e.push(t("<ul>").addClass(a.CLASSNAME_GROUP).appendTo(i));a.lazy?n.lazyLoad(s):n.addItem(s,0),o.remove()},addItem:function(i,a,n){var o=this,e=o.itemsGroup,s=0;o.o.lazy?n?s=o.o.initNum:(s=a+o.o.cols,o.startIdx=s=s<=i.length?s:i.length):s=t(i).length;for(var l=a;s>l;l++){var r=o.o.animation;t(i[l]).css("visibility","visible"),r&&"string"==typeof r&&t(i[l]).fadeIn(r),t(e[0]).append(t(i[l])),e.sort(function(t,i){return t.height()-i.height()})}},lazyLoad:function(i){var a=this,n=a.el,o=n.parent();if(a.o.initNum>=i.length)return void a.addItem(i,0,!0);for(a.addItem(i,0,!0),a.startIdx=a.o.initNum;;){var e=o.height(),s=n.height();if(!(e>=s&&a.startIdx<i.length)){if(a.startIdx>=i.length)return;break}a.addItem(i,a.startIdx)}t(o).scroll(function(){var e=o.scrollTop(),s=o.height(),l=n.height(),r=l-s;e+10>=r&&(a.addItem(i,a.startIdx),a.startIdx+a.o.cols<i.length?a.startIdx+=a.o.cols:t(o).off("scroll"))})}},t.fn.waterfall=function(i){var n=this.length;return this.each(function(o){var e=t(this),s="waterfall"+(n>1?"-"+ ++o:""),l=(new a).init(e,i);e.data(s,l).data("key",s)})},a.version="1.0.0"}(jQuery,!1);