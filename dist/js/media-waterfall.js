!function(t,i){var a=function(){this.o={cols:4,lazy:i,initNum:15,animation:null,CLASSNAME_ITEM:"media-item",CLASSNAME_GROUP:"items-group",CLASSNAME_COLS_PREFIX:"media-col"}};a.prototype={init:function(i,a){var o=this,n=o.el=i;a&&(a.cols&&(a.cols<2||isNaN(parseInt(a.cols)))&&(a.cols=o.o.cols,alert("cols参数值非法！已设为默认值")),a.initNum&&(a.initNum<o.o.cols||isNaN(parseInt(a.initNum)))&&(a.initNum=o.o.initNum,alert("initNum参数值非法！已设为默认值")));var a=o.o=t.extend(o.o,a),e=o.itemsGroup=[],l=0!=i.find("."+a.CLASSNAME_ITEM).length?i.find("."+a.CLASSNAME_ITEM):i.find("li"),s=t("<div>").addClass(i.attr("class"));i.after(s),o.el=i=s,i.addClass(a.CLASSNAME_COLS_PREFIX+a.cols);for(var r=0;r<a.cols;r++)e.push(t("<ul>").addClass(a.CLASSNAME_GROUP).appendTo(i));a.lazy?o.lazyLoad(l):o.addItem(l,0),n.remove()},addItem:function(i,a,o){var n=this,e=n.itemsGroup,l=0;l=n.o.lazy?o?n.o.initNum:a+n.o.cols<=i.length?a+n.o.cols:i.length:t(i).length;for(var s=a;l>s;s++){var r=n.o.animation;t(i[s]).css("visibility","visible"),r&&"string"==typeof r&&t(i[s]).fadeIn(r),t(e[0]).append(t(i[s])),e.sort(function(t,i){return t.height()-i.height()})}},lazyLoad:function(i){var a=this,o=a.el,n=o.parent();if(a.o.initNum>=i.length)return void a.addItem(i,0,!0);for(a.addItem(i,0,!0);;){a.startIdx=a.o.initNum;var e=n.height(),l=o.height();if(!(e>=l&&a.startIdx<i.length)){if(a.startIdx>=i.length)return;break}a.startIdx+a.o.cols<i.length?a.o.initNum+=a.o.cols:a.o.initNum=i.length,a.addItem(i,a.startIdx)}t(n).scroll(function(){var e=n.scrollTop(),l=n.height(),s=o.height(),r=s-l;e+10>=r&&(a.addItem(i,a.startIdx),a.startIdx+a.o.cols<i.length?a.startIdx+=a.o.cols:t(n).off("scroll"))})}},t.fn.waterfall=function(i){var o=this.length;return this.each(function(n){var e=t(this),l="waterfall"+(o>1?"-"+ ++n:""),s=(new a).init(e,i);e.data(l,s).data("key",l)})},a.version="1.0.0"}(jQuery,!1);